<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BullyBlock AI ‚Äì Dashboard</title>
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>BullyBlock AI</h2>
      <ul class="nav-menu">
        <li class="active"><a href="dashboard.html"><i class="fa-solid fa-gauge"></i> Dashboard</a></li>
        <li><a href="reports.html"><i class="fa-solid fa-flag"></i> Reports</a></li>
         <li><a href="reviews.html"><i class="fa-solid fa-pen"></i> Reviews</a></li>
         <li><a href="graph.html"><i class="fa-solid fa-chart-pie"></i> Graph</a></li>
        <li><a href="settings.html"><i class="fa-solid fa-gear"></i> Settings</a></li>
        <li id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Logout</li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <h1>Welcome, Official</h1>
      <p class="sub-heading">Monitoring live toxic messages</p>

      <div class="stats-cards">
        <div class="card">
          <h3>Total Messages Analyzed</h3>
          <p id="totalMessages">0</p>
        </div>
        <div class="card">
          <h3>High Severity Alerts</h3>
          <p id="highAlerts">0</p>
        </div>
        <div class="card">
          <h3>Flagged Users</h3>
          <p id="flaggedUsers">0</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Firebase + Logout Script -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDFqoJ0cxZRj6Gf_Q4h5awQa_7xTilR7AM",
      authDomain: "bully-block-ai-39bf7.firebaseapp.com",
      databaseURL: "https://bully-block-ai-39bf7-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "bully-block-ai-39bf7",
      storageBucket: "bully-block-ai-39bf7.firebasestorage.app",
      messagingSenderId: "1029684496192",
      appId: "1:1029684496192:web:ea9e7f5f8a5e5022ca5ca5"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const logoutBtn = document.getElementById("logoutBtn");

    // Redirect to login if user is not logged in
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      }
    });

    // Logout functionality
    logoutBtn.addEventListener("click", () => {
      signOut(auth)
        .then(() => {
          window.location.href = "login.html"; // redirect after logout
        })
        .catch((error) => {
          alert("Error signing out: " + error.message);
        });
    });

    // üîπ Fetch live stats from Flask backend
    async function loadStats() {
      try {
        const res = await fetch("http://127.0.0.1:5000/stats");
        const data = await res.json();

        document.getElementById("totalMessages").innerText = data.total;
        document.getElementById("highAlerts").innerText = data.high;
        document.getElementById("flaggedUsers").innerText = data.flagged;

        console.log("‚úÖ Stats loaded:", data);
      } catch (error) {
        console.error("‚ùå Error loading stats:", error);
      }
    }

    // Load once on page open
    loadStats();

    // Refresh every 5 seconds
    setInterval(loadStats, 5000);
  </script>
</body>
</html>
